<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>BAGDigital.tech — Competition Day Tools</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

  <script type="module" src="https://cdn.cubing.net/v0/js/cubing/twisty"></script>
  <script type="module">import 'https://unpkg.com/@material/web/all.js?module';</script>

  <style>
    :root{
      --b:#0047FF; --bg:#FFFFFF; --ink:#000000; --muted:#333333;
      --panel:#F4F7FF; --r24:24px;
      font-family:'Roboto',sans-serif;
    }
    *{box-sizing:border-box; max-width:100%;}
    html,body{width:100%; overflow-x:hidden;}
    body{margin:0;background:var(--bg);color:var(--ink);line-height:1.55;}
    .container{max-width:1100px;margin:0 auto;padding:0 16px;}

    header{
      padding:12px 0;border-bottom:1px solid #EEE;background:#fff;
      position:sticky;top:0;z-index:10;
    }
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;}
    .brand{font-size:1.35rem;font-weight:900;letter-spacing:-1px;white-space:nowrap;}
    .top-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}

    /* On competition day, keep it tight and scannable */
    .hero{padding:16px 0 10px;display:grid;grid-template-columns:1fr;gap:10px;}
    .kicker{color:var(--b);font-weight:900;text-transform:uppercase;letter-spacing:1px;margin:0;}
    .hero h1{font-size:clamp(1.85rem,6vw,2.75rem);font-weight:900;margin:0;line-height:1.06;letter-spacing:-1.25px;}
    .hero p{margin:6px 0 0;font-size:1.02rem;}
    .hero-badges{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:999px;border:1px solid #DDD;background:#fff;
      font-weight:900;color:#000;
    }
    .badge strong{color:var(--b);}

    /* Tool */
    .tool-section{
      background:var(--panel);padding:16px;border-radius:var(--r24);
      margin:10px 0 12px;border:3px solid #E0E4FF;
    }
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px;}
    select#eventSelect{
      flex:1;min-width:160px;height:50px;border-radius:12px;border:3px solid var(--ink);
      background:#FFF;font-size:1.02rem;font-weight:900;padding:0 12px;cursor:pointer;
    }
    .scramble{
      background:#000;color:#00FF41;padding:14px;border-radius:12px;
      font-family:'Courier New',monospace;font-size:1.02rem;min-height:54px;
      border:2px solid #333;word-wrap:break-word;text-align:center;
    }
    .viz-box{
      background:#FFF;border-radius:15px;margin:12px 0;border:1px solid #CCC;padding:10px;
      display:flex;justify-content:center;align-items:center;
      height:260px; /* fixed so nothing "resizes" */
    }
    twisty-player{width:100%;height:240px;}
    @media (min-width:900px){
      .viz-box{height:300px;}
      twisty-player{height:280px;}
    }

    .timer-zone{
      background:#fff;border:1px solid #E7E7E7;border-radius:16px;
      padding:12px;margin-top:10px;
    }
    .timer{
      font-size:clamp(3.0rem,12vw,5.6rem);
      font-weight:900;text-align:center;margin:4px 0 0;
      font-variant-numeric:tabular-nums;
    }
    .timer-meta{
      display:flex;justify-content:center;gap:10px;flex-wrap:wrap;
      font-weight:800;color:var(--muted);margin-top:8px;
    }
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;border:1px solid #DDD;background:#fff;
      font-weight:900;color:#000;
    }
    .pill strong{color:var(--b);}
    .tip{margin:10px 0 0;text-align:center;color:var(--muted);font-weight:700;}

    .tool-cta{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:12px;}

    /* Organizer */
    .organizer{
      background:#fff;border:1px solid #EEE;border-radius:20px;
      padding:16px;margin:12px 0 14px;
      box-shadow:0 8px 18px rgba(0,0,0,0.05);
    }
    .organizer h2{margin:0 0 6px;font-size:1.35rem;letter-spacing:-0.5px;}
    .organizer p{margin:0 0 10px;color:var(--muted);font-weight:700;}
    .org-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:10px;}
    .org-card{border:1px solid #EEE;border-radius:16px;padding:14px;background:#fff;}
    .org-card h3{margin:0 0 8px;font-size:1.05rem;}
    .checklist{margin:0;padding-left:18px;}
    .checklist li{margin:8px 0;font-weight:800;}

    /* No resize handles anywhere */
    textarea{resize:none !important;}

    .note{
      width:100%;
      height:140px; /* fixed height; no resize needed */
      overflow:auto;
      padding:12px;border-radius:12px;border:2px solid #DDD;
      font-weight:800;font-size:1rem;
    }
    .smallmuted{margin:8px 0 0;color:var(--muted);font-weight:700;}
    .mini-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}

    /* Session log — table on desktop, cards on mobile. No horizontal scrolling. */
    .session{
      margin-top:12px;background:#fff;border:1px solid #E7E7E7;border-radius:16px;overflow:hidden;
    }
    .session-head{
      padding:12px 12px;border-bottom:1px solid #EEE;
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
    }
    .session-head h3{margin:0;font-size:1.05rem;}
    .session-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .empty{padding:12px;color:var(--muted);font-weight:800;}

    table{width:100%;border-collapse:collapse;}
    th,td{padding:10px 12px;border-bottom:1px solid #F0F0F0;text-align:left;}
    th{font-size:0.9rem;color:#222;text-transform:uppercase;letter-spacing:0.7px;}
    td{font-weight:800;}
    td.mono{font-family:'Courier New',monospace;font-weight:900;}

    /* Mobile: switch to card list (no resize, no scroll) */
    .solve-cards{display:none; padding:12px; gap:10px;}
    .solve-card{
      border:1px solid #EEE;border-radius:14px;padding:12px;background:#fff;
      display:grid;grid-template-columns:1fr 1fr;gap:8px;
    }
    .solve-card .label{color:var(--muted);font-weight:900;text-transform:uppercase;letter-spacing:0.6px;font-size:0.8rem;}
    .solve-card .value{font-weight:900;}
    .solve-card .mono{font-family:'Courier New',monospace;}

    @media (max-width:640px){
      table{display:none;}
      .solve-cards{display:grid;}
    }

    /* Offers */
    .offers{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:14px;margin:14px 0 34px;
    }
    .card{
      background:#fff;padding:16px;border-radius:18px;border:1px solid #EEE;
      box-shadow:0 8px 18px rgba(0,0,0,0.06);
    }
    .card h3{margin:0 0 8px;font-size:1.15rem;}
    .card ul{margin:0 0 10px;padding-left:18px;}
    .card li{margin:6px 0;font-weight:800;}
    .meta{font-weight:900;color:var(--ink);}
    .price{font-weight:900;color:var(--b);}
    .small{color:var(--muted);font-weight:700;margin:0;}

    /* Contact */
    .contact{
      background:#000;color:#FFF;padding:54px 0;border-radius:34px 34px 0 0;margin-top:8px;
    }
    .form-box{max-width:560px;margin:0 auto;}
    .contact h2{margin:0 0 14px;text-align:center;font-size:1.75rem;letter-spacing:-1px;}
    input, select.form-input, textarea.form-text{
      width:100%;padding:14px;margin-bottom:12px;border-radius:10px;
      border:2px solid #444;background:#111;color:#FFF;font-size:1rem;
    }
    textarea.form-text{height:130px; overflow:auto;}
    .btn{width:100%;padding:16px;background:var(--b);color:#FFF;border:none;border-radius:10px;font-weight:900;cursor:pointer;}
    .btn:disabled{opacity:0.65;cursor:not-allowed;}
    .status{margin-top:12px;text-align:center;font-weight:900;}
    .fineprint{margin:10px 0 0;text-align:center;color:#BDBDBD;font-weight:700;font-size:0.95rem;}
  </style>
</head>

<body>
  <header>
    <div class="container topbar">
      <strong class="brand">BAGDigital<span style="color:var(--b);">.tech</span></strong>
      <div class="top-actions">
        <md-outlined-button onclick="document.getElementById('organizer').scrollIntoView({behavior:'smooth'})">
          Organizer
        </md-outlined-button>
        <md-filled-button onclick="document.getElementById('tool').scrollIntoView({behavior:'smooth'})">
          Timer
        </md-filled-button>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="hero">
      <p class="kicker">Competition Day</p>
      <h1>Scrambles, Timer, and a Quick Organizer.</h1>
      <p>Most people scanning this are already in the venue. Use this page to stay ready between rounds.</p>
      <div class="hero-badges">
        <span class="badge">Free: <strong>Always</strong></span>
        <span class="badge">No login: <strong>Yes</strong></span>
        <span class="badge">Built by: <strong>BAG Digital</strong></span>
      </div>
    </section>

    <!-- TOOL -->
    <section id="tool" class="tool-section" aria-label="Cubing scrambler and timer">
      <div class="controls">
        <select id="eventSelect" aria-label="Select event">
          <option value="222">2x2x2</option>
          <option value="333" selected>3x3x3</option>
          <option value="444">4x4x4</option>
          <option value="555">5x5x5</option>
          <option value="666">6x6x6</option>
          <option value="777">7x7x7</option>
          <option value="sq1">Square-1</option>
          <option value="pyram">Pyraminx</option>
          <option value="minx">Megaminx</option>
          <option value="skewb">Skewb</option>
          <option value="clock">Clock</option>
        </select>

        <md-outlined-button id="newScrambleBtn">Next Scramble</md-outlined-button>
      </div>

      <div class="scramble" id="scrambleText">Connecting...</div>

      <div class="viz-box">
        <twisty-player id="player" background="none" control-panel="none" visualization="2D"></twisty-player>
      </div>

      <div class="timer-zone">
        <div class="timer" id="timeDisplay">0.00</div>

        <div class="timer-meta">
          <span class="pill">Event: <strong id="eventLabel">3x3x3</strong></span>
          <span class="pill">Last: <strong id="lastTime">—</strong></span>
          <span class="pill">Best: <strong id="bestTime">—</strong></span>
        </div>

        <p class="tip">
          Space = start/stop (desktop). Tap Start/Stop (mobile). Stopping logs event + time. Nothing resizes.
        </p>

        <div class="tool-cta">
          <md-filled-button id="startStopBtn">Start</md-filled-button>
          <md-outlined-button id="newSolveScrambleBtn">New Scramble</md-outlined-button>
          <md-outlined-button id="resetSessionBtn">Clear Session</md-outlined-button>
        </div>
      </div>

      <div class="session" aria-label="Session log">
        <div class="session-head">
          <h3>Session Log</h3>
          <div class="session-actions">
            <md-outlined-button id="copyCsvBtn">Copy CSV</md-outlined-button>
            <md-outlined-button id="downloadCsvBtn">Download CSV</md-outlined-button>
          </div>
        </div>

        <div id="emptyState" class="empty">No solves yet. Start then stop to log a solve.</div>

        <!-- Desktop table -->
        <table id="sessionTable" style="display:none;">
          <thead>
            <tr>
              <th>#</th>
              <th>Event</th>
              <th>Time (s)</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody id="sessionBody"></tbody>
        </table>

        <!-- Mobile cards -->
        <div id="solveCards" class="solve-cards" aria-label="Mobile session cards"></div>
      </div>
    </section>

    <!-- ORGANIZER -->
    <section id="organizer" class="organizer" aria-label="Competition day organizer">
      <h2>Competition Day Organizer (Cuber + Parent)</h2>
      <p>Checklist + notes that save on your phone. No account. No resizing.</p>

      <div class="org-grid">
        <div class="org-card">
          <h3>5-Minute Ready Check</h3>
          <ul class="checklist">
            <li><label><input type="checkbox" data-k="badge"> Badge / wristband / check-in done</label></li>
            <li><label><input type="checkbox" data-k="cube"> Correct cube(s) for next event</label></li>
            <li><label><input type="checkbox" data-k="tools"> Lube / screwdriver / cloth</label></li>
            <li><label><input type="checkbox" data-k="water"> Water + snack</label></li>
            <li><label><input type="checkbox" data-k="warmup"> Warm-up: 3–5 solves, then stop</label></li>
          </ul>
        </div>

        <div class="org-card">
          <h3>Parent Ops Checklist</h3>
          <ul class="checklist">
            <li><label><input type="checkbox" data-k="schedule"> Next event + group time known</label></li>
            <li><label><input type="checkbox" data-k="quiet"> Quiet zone plan (lower stress)</label></li>
            <li><label><input type="checkbox" data-k="food"> Food/hydration between rounds</label></li>
            <li><label><input type="checkbox" data-k="ride"> End-time + ride plan confirmed</label></li>
            <li><label><input type="checkbox" data-k="pics"> Photos after solves, not before</label></li>
          </ul>
        </div>

        <div class="org-card">
          <h3>My Notes (rounds / goals / reminders)</h3>
          <textarea class="note" id="notes" placeholder="Example: 3x3 R1 — steady solves. Slow inspection. Breathe."></textarea>
          <p class="smallmuted">Tip: one goal per event.</p>
          <div class="mini-actions">
            <md-outlined-button id="copyNotesBtn">Copy Notes</md-outlined-button>
            <md-outlined-button id="clearNotesBtn">Clear Notes</md-outlined-button>
          </div>
        </div>

        <div class="org-card">
          <h3>Between-Rounds Plan</h3>
          <ul class="checklist">
            <li><strong>Right after:</strong> hydrate + reset mentally</li>
            <li><strong>10–20 min:</strong> light snack, calm hands</li>
            <li><strong>Last 10 min:</strong> no new algs, no panic</li>
            <li><strong>Call time:</strong> cube legal, timer ok</li>
          </ul>
        </div>
      </div>

      <div class="mini-actions" style="margin-top:12px;">
        <md-filled-button id="resetOrganizerBtn">Reset Organizer</md-filled-button>
        <md-outlined-button onclick="document.getElementById('contact').scrollIntoView({behavior:'smooth'})">Business Automation</md-outlined-button>
      </div>
    </section>

    <!-- SERVICES (secondary) -->
    <section id="offers" class="offers" aria-label="Services">
      <div class="card">
        <h3>Lead Intake Automation</h3>
        <ul>
          <li>Form → Google Sheet pipeline</li>
          <li>Instant notifications (email; SMS optional)</li>
          <li>Simple follow-up workflow</li>
        </ul>
        <p class="small"><span class="meta">Starting at:</span> <span class="price">$750</span></p>
      </div>

      <div class="card">
        <h3>Basic Website + Contact</h3>
        <ul>
          <li>Fast, mobile-first one-page</li>
          <li>Contact form + tracking</li>
          <li>Deploy on your domain</li>
        </ul>
        <p class="small"><span class="meta">Starting at:</span> <span class="price">$600</span></p>
      </div>

      <div class="card">
        <h3>Ops Automation (Small System)</h3>
        <ul>
          <li>Tracking + dashboards</li>
          <li>Status workflow + audit trail</li>
          <li>Google Workspace-native</li>
        </ul>
        <p class="small"><span class="meta">Starting at:</span> <span class="price">$1,500</span></p>
      </div>
    </section>
  </div>

  <!-- CONTACT -->
  <section class="contact" id="contact">
    <div class="container">
      <div class="form-box">
        <h2>Work With BAG Digital</h2>

        <form id="leadForm">
          <input type="text" name="website" tabindex="-1" autocomplete="off"
                 style="position:absolute; left:-9999px; height:1px; width:1px; opacity:0;" />

          <input type="text" name="name" placeholder="Name / Business" required>
          <input type="email" name="email" placeholder="Email Address" required>

          <select name="service" class="form-input" aria-label="Select service">
            <option value="Lead Intake">Lead Intake Automation</option>
            <option value="Website">Basic Website + Contact</option>
            <option value="Automation">Ops Automation (Small System)</option>
          </select>

          <textarea class="form-text" name="message" rows="4" placeholder="What do you want to automate or fix? (lead capture, follow-up, tracking, scheduling, inventory, etc.)"></textarea>

          <button type="submit" class="btn" id="subBtn">Send</button>
        </form>

        <div id="status" class="status"></div>
        <p class="fineprint">I reply with a simple plan and next steps. No retainer required.</p>
      </div>
    </div>
  </section>

  <!-- Scrambler -->
  <script type="module">
    import { randomScrambleForEvent } from "https://cdn.cubing.net/v0/js/cubing/scramble";

    const player = document.getElementById('player');
    const scrambleText = document.getElementById('scrambleText');
    const eventSelect = document.getElementById('eventSelect');
    const eventLabel = document.getElementById('eventLabel');

    const puzzleMap = {
      "333": "3x3x3", "222": "2x2x2", "444": "4x4x4", "555": "5x5x5", "666": "6x6x6", "777": "7x7x7",
      "sq1": "square1", "pyram": "pyraminx", "minx": "megaminx", "skewb": "skewb", "clock": "clock"
    };

    const eventNames = {
      "222": "2x2x2", "333": "3x3x3", "444": "4x4x4", "555": "5x5x5", "666": "6x6x6", "777": "7x7x7",
      "sq1": "Square-1", "pyram": "Pyraminx", "minx": "Megaminx", "skewb": "Skewb", "clock": "Clock"
    };

    function setEventLabel(){
      eventLabel.textContent = eventNames[eventSelect.value] || eventSelect.value;
    }

    async function updateScramble(){
      const ev = eventSelect.value;
      setEventLabel();
      scrambleText.innerText = "Syncing...";
      try{
        const alg = await randomScrambleForEvent(ev);
        const str = alg.toString();
        scrambleText.innerText = str;

        player.puzzle = puzzleMap[ev];
        player.alg = str;
      }catch(e){
        scrambleText.innerText = "Error. Please refresh.";
      }
    }

    document.getElementById('newScrambleBtn').onclick = updateScramble;
    document.getElementById('newSolveScrambleBtn').onclick = updateScramble;
    eventSelect.onchange = updateScramble;

    updateScramble();
  </script>

  <!-- Timer + session logging (table + mobile cards) -->
  <script>
    const timeDisplay = document.getElementById('timeDisplay');
    const startStopBtn = document.getElementById('startStopBtn');
    const resetSessionBtn = document.getElementById('resetSessionBtn');

    const lastTimeEl = document.getElementById('lastTime');
    const bestTimeEl = document.getElementById('bestTime');

    const sessionTable = document.getElementById('sessionTable');
    const sessionBody = document.getElementById('sessionBody');
    const solveCards = document.getElementById('solveCards');
    const emptyState = document.getElementById('emptyState');

    const copyCsvBtn = document.getElementById('copyCsvBtn');
    const downloadCsvBtn = document.getElementById('downloadCsvBtn');

    const eventSelect = document.getElementById('eventSelect');

    const eventNames = {
      "222": "2x2x2", "333": "3x3x3", "444": "4x4x4", "555": "5x5x5", "666": "6x6x6", "777": "7x7x7",
      "sq1": "Square-1", "pyram": "Pyraminx", "minx": "Megaminx", "skewb": "Skewb", "clock": "Clock"
    };

    let running = false;
    let startTime = 0;
    let interval = null;

    window.__bagLastSolve = null;
    let session = [];

    function fmtTime(sec){ return Number(sec).toFixed(2); }

    function updateBestAndLast(){
      if(session.length === 0){
        lastTimeEl.textContent = "—";
        bestTimeEl.textContent = "—";
        return;
      }
      const last = session[session.length - 1];
      lastTimeEl.textContent = `${fmtTime(last.timeSec)}s`;
      const best = session.reduce((m,x)=>Math.min(m,x.timeSec), Infinity);
      bestTimeEl.textContent = `${fmtTime(best)}s`;
    }

    function render(){
      const has = session.length > 0;

      emptyState.style.display = has ? "none" : "block";
      sessionTable.style.display = has ? "table" : "none";

      // table rows
      sessionBody.innerHTML = has ? session.map((row) => {
        const when = new Date(row.tsIso).toLocaleString();
        return `
          <tr>
            <td>${row.n}</td>
            <td>${row.eventName}</td>
            <td class="mono">${fmtTime(row.timeSec)}</td>
            <td>${when}</td>
          </tr>
        `;
      }).join("") : "";

      // mobile cards
      solveCards.innerHTML = has ? session.slice().reverse().map((row) => {
        const when = new Date(row.tsIso).toLocaleString();
        return `
          <div class="solve-card">
            <div>
              <div class="label">Solve</div>
              <div class="value">#${row.n}</div>
            </div>
            <div>
              <div class="label">Event</div>
              <div class="value">${row.eventName}</div>
            </div>
            <div>
              <div class="label">Time</div>
              <div class="value mono">${fmtTime(row.timeSec)}s</div>
            </div>
            <div>
              <div class="label">When</div>
              <div class="value">${when}</div>
            </div>
          </div>
        `;
      }).join("") : "";
    }

    function getCsv(){
      const header = ["solve","event","time_seconds","timestamp_iso"];
      const lines = session.map(r => [r.n, r.eventName, fmtTime(r.timeSec), r.tsIso].join(","));
      return [header.join(","), ...lines].join("\n");
    }

    async function copyCsv(){
      if(session.length === 0) return;
      try{
        await navigator.clipboard.writeText(getCsv());
        copyCsvBtn.textContent = "Copied";
        setTimeout(()=>copyCsvBtn.textContent="Copy CSV", 900);
      }catch{
        copyCsvBtn.textContent = "Copy failed";
        setTimeout(()=>copyCsvBtn.textContent="Copy CSV", 900);
      }
    }

    function downloadCsv(){
      if(session.length === 0) return;
      const blob = new Blob([getCsv()], {type:"text/csv;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "bagdigital_cubing_session.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function startTimer(){
      if(running) return;
      running = true;
      startStopBtn.textContent = "Stop";
      startTime = performance.now();
      interval = setInterval(() => {
        timeDisplay.textContent = ((performance.now() - startTime) / 1000).toFixed(2);
      }, 10);
    }

    function stopTimerAndLog(){
      if(!running) return;
      running = false;
      clearInterval(interval);
      interval = null;

      const elapsed = (performance.now() - startTime) / 1000;
      const elapsedFixed = Number(elapsed.toFixed(2));

      timeDisplay.textContent = elapsedFixed.toFixed(2);
      startStopBtn.textContent = "Start";

      const eventCode = eventSelect.value;
      const eventName = eventNames[eventCode] || eventCode;

      const entry = {
        n: session.length + 1,
        eventCode,
        eventName,
        timeSec: elapsedFixed,
        tsIso: new Date().toISOString()
      };

      session.push(entry);
      window.__bagLastSolve = entry;

      updateBestAndLast();
      render();
    }

    function toggleTimer(){
      if(running) stopTimerAndLog();
      else startTimer();
    }

    function clearSession(){
      running = false;
      if(interval) clearInterval(interval);
      interval = null;

      session = [];
      timeDisplay.textContent = "0.00";
      startStopBtn.textContent = "Start";
      window.__bagLastSolve = null;

      updateBestAndLast();
      render();
    }

    startStopBtn.addEventListener("click", (e) => { e.preventDefault(); startStopBtn.blur(); toggleTimer(); });
    resetSessionBtn.addEventListener("click", (e) => { e.preventDefault(); resetSessionBtn.blur(); clearSession(); });

    copyCsvBtn.addEventListener("click", copyCsv);
    downloadCsvBtn.addEventListener("click", downloadCsv);

    window.addEventListener("keydown", (e) => {
      if(e.code !== "Space") return;
      if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)) return;
      e.preventDefault();
      toggleTimer();
    });

    updateBestAndLast();
    render();
  </script>

  <!-- Organizer persistence (localStorage) -->
  <script>
    const LS_KEY = "bag_competition_organizer_v2";

    const organizerRoot = document.getElementById("organizer");
    const notesEl = document.getElementById("notes");
    const copyNotesBtn = document.getElementById("copyNotesBtn");
    const clearNotesBtn = document.getElementById("clearNotesBtn");
    const resetOrganizerBtn = document.getElementById("resetOrganizerBtn");

    function loadOrganizer(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const data = JSON.parse(raw);

        const boxes = organizerRoot.querySelectorAll('input[type="checkbox"][data-k]');
        boxes.forEach((b) => {
          const k = b.getAttribute("data-k");
          if (k in (data.checks || {})) b.checked = !!data.checks[k];
        });

        if(typeof data.notes === "string") notesEl.value = data.notes;
      }catch{}
    }

    function saveOrganizer(){
      try{
        const boxes = organizerRoot.querySelectorAll('input[type="checkbox"][data-k]');
        const checks = {};
        boxes.forEach((b) => checks[b.getAttribute("data-k")] = b.checked);
        localStorage.setItem(LS_KEY, JSON.stringify({ checks, notes: notesEl.value || "" }));
      }catch{}
    }

    function resetOrganizer(){
      const boxes = organizerRoot.querySelectorAll('input[type="checkbox"][data-k]');
      boxes.forEach((b) => b.checked = false);
      notesEl.value = "";
      saveOrganizer();
    }

    organizerRoot.addEventListener("change", (e) => {
      if(e.target && e.target.matches('input[type="checkbox"][data-k]')) saveOrganizer();
    });
    notesEl.addEventListener("input", saveOrganizer);

    copyNotesBtn.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(notesEl.value || "");
        copyNotesBtn.textContent = "Copied";
        setTimeout(()=>copyNotesBtn.textContent="Copy Notes", 900);
      }catch{
        copyNotesBtn.textContent = "Copy failed";
        setTimeout(()=>copyNotesBtn.textContent="Copy Notes", 900);
      }
    });

    clearNotesBtn.addEventListener("click", () => { notesEl.value = ""; saveOrganizer(); });
    resetOrganizerBtn.addEventListener("click", resetOrganizer);

    loadOrganizer();
  </script>

  <!-- Lead form submit -> Google Apps Script Web App (server unchanged) -->
  <script>
    const LEAD_ENDPOINT = "https://script.google.com/macros/s/AKfycbyXBZI3EMxmo3jS0VKhwiky9fVrgiOGGrm3EpYM-WS7v2ZEGkZ8tTODIKno8HhJ00jsew/exec"; // <-- paste your deployed URL
    const HONEYPOT_NAME = "website";

    const form = document.getElementById("leadForm");
    const statusEl = document.getElementById("status");
    const subBtn = document.getElementById("subBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      subBtn.disabled = true;
      subBtn.textContent = "Sending...";

      const fd = new FormData(form);

      if ((fd.get(HONEYPOT_NAME) || "").toString().trim().length > 0) {
        subBtn.disabled = false;
        subBtn.textContent = "Send";
        return;
      }

      fd.append("source", "competition-day-page");
      fd.append("pageTitle", document.title);
      fd.append("timestamp", new Date().toISOString());
      fd.append("userAgent", navigator.userAgent);

      if (window.__bagLastSolve) {
        fd.append("lastSolveEvent", window.__bagLastSolve.eventName);
        fd.append("lastSolveTimeSec", String(window.__bagLastSolve.timeSec));
      }

      try{
        const organizerRaw = localStorage.getItem("bag_competition_organizer_v2");
        if (organizerRaw) fd.append("organizerData", organizerRaw);
      }catch{}

      try {
        const res = await fetch(LEAD_ENDPOINT, { method: "POST", body: fd });
        const data = await res.json().catch(() => ({}));
        if (!res.ok || !data.ok) throw new Error("Bad response");

        statusEl.textContent = "Received. I’ll reply soon.";
        form.reset();
      } catch (err) {
        statusEl.textContent = "Error sending. Please email Jaime@BAGdigital.tech.";
      } finally {
        subBtn.disabled = false;
        subBtn.textContent = "Send";
      }
    });
  </script>

</body>
</html>
