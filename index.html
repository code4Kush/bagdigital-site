<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>BAGDigital.tech — Competition Day Tools</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

  <script type="module" src="https://cdn.cubing.net/v0/js/cubing/twisty"></script>
  <script type="module">import 'https://unpkg.com/@material/web/all.js?module';</script>

  <style>
    :root{
      --b:#0047FF; --bg:#FFFFFF; --ink:#000000; --muted:#333333;
      --panel:#F4F7FF; --r24:24px;
      font-family:'Roboto',sans-serif;
    }
    *{box-sizing:border-box;}
    html,body{height:100%; margin:0;}
    body{background:var(--bg);color:var(--ink);line-height:1.55;}
    a,button,select{touch-action:manipulation;}

    /* App layout: full height, no sideways scroll */
    .app{
      min-height:100svh; /* stable viewport on mobile */
      display:flex;
      flex-direction:column;
    }

    header{
      padding:10px 14px;border-bottom:1px solid #EEE;background:#fff;
      position:sticky;top:0;z-index:10;
    }
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;}
    .brand{font-size:1.25rem;font-weight:900;letter-spacing:-1px;white-space:nowrap;}
    .top-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}

    /* Main content: keep everything readable, timer screen uses the full viewport */
    main{flex:1; display:flex; flex-direction:column; gap:12px; padding:12px 14px;}

    /* TIMER SCREEN (tap anywhere) */
    .timer-screen{
      background:var(--panel);
      border:3px solid #E0E4FF;
      border-radius:22px;
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      padding:14px;
      position:relative;
      user-select:none;
      -webkit-user-select:none;
      touch-action:manipulation; /* prevents double-tap zoom */
      outline:none;
    }
    .timer-top{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      width:100%;
    }
    select#eventSelect{
      flex:1;
      min-width:160px;
      height:48px;
      border-radius:12px;
      border:3px solid var(--ink);
      background:#FFF;
      font-size:1rem;
      font-weight:900;
      padding:0 12px;
      cursor:pointer;
    }

    .scramble{
      width:100%;
      background:#000;color:#00FF41;
      padding:12px;
      border-radius:12px;
      font-family:'Courier New',monospace;
      font-size:1rem;
      min-height:52px;
      border:2px solid #333;
      text-align:center;
      word-wrap:break-word;
    }

    .timer-mid{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:10px 0;
      gap:10px;
    }
    .time{
      font-weight:900;
      letter-spacing:-1px;
      font-variant-numeric:tabular-nums;
      /* Big, screen-filling time without overflow */
      font-size: clamp(4.0rem, 18vw, 9rem);
      line-height:1;
    }
    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      font-weight:900;
      color:var(--muted);
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid #DDD;
      background:#fff;
      color:#000;
      font-weight:900;
      white-space:nowrap;
    }
    .pill strong{color:var(--b);}

    .tap-hint{
      text-align:center;
      font-weight:800;
      color:var(--muted);
      margin-top:6px;
    }

    .timer-bottom{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }

    /* Optional secondary panel (collapsed by default on small screens) */
    details.panel{
      background:#fff;
      border:1px solid #EEE;
      border-radius:18px;
      overflow:hidden;
    }
    details.panel > summary{
      padding:12px 14px;
      cursor:pointer;
      font-weight:900;
      list-style:none;
    }
    details.panel > summary::-webkit-details-marker{display:none;}
    .panel-inner{padding:0 14px 14px;}

    /* Session log: cards only (no resize, no horizontal scroll) */
    .solve-cards{
      display:grid;
      gap:10px;
      padding-top:10px;
    }
    .solve-card{
      border:1px solid #EEE;border-radius:14px;padding:12px;background:#fff;
      display:grid;grid-template-columns:1fr 1fr;gap:8px;
    }
    .label{color:var(--muted);font-weight:900;text-transform:uppercase;letter-spacing:0.6px;font-size:0.8rem;}
    .value{font-weight:900;}
    .mono{font-family:'Courier New',monospace;}

    /* Organizer */
    .organizer{display:grid; gap:10px;}
    .org-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px;}
    .org-card{border:1px solid #EEE;border-radius:16px;padding:12px;background:#fff;}
    .org-card h3{margin:0 0 8px;font-size:1.05rem;}
    .checklist{margin:0;padding-left:18px;}
    .checklist li{margin:8px 0;font-weight:800;}
    textarea{resize:none !important;}
    .note{
      width:100%;
      height:140px;
      overflow:auto;
      padding:12px;border-radius:12px;border:2px solid #DDD;
      font-weight:800;font-size:1rem;
    }
    .mini-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}

    /* Contact */
    .contact{
      background:#000;color:#FFF;padding:24px 14px;
      border-radius:22px;
    }
    .contact h2{margin:0 0 12px;text-align:center;font-size:1.6rem;letter-spacing:-1px;}
    input, select.form-input, textarea.form-text{
      width:100%;padding:14px;margin-bottom:12px;border-radius:10px;
      border:2px solid #444;background:#111;color:#FFF;font-size:1rem;
    }
    textarea.form-text{height:120px; overflow:auto;}
    .btn{width:100%;padding:16px;background:var(--b);color:#FFF;border:none;border-radius:10px;font-weight:900;cursor:pointer;}
    .btn:disabled{opacity:0.65;cursor:not-allowed;}
    .status{margin-top:10px;text-align:center;font-weight:900;}
    .fineprint{margin:10px 0 0;text-align:center;color:#BDBDBD;font-weight:700;font-size:0.95rem;}

    /* Prevent accidental zooming on form fields on iOS by keeping font-size >= 16px */
    input, select, textarea{font-size:16px;}

    /* Make timer screen really fill the display on very small devices */
    @media (max-height:720px){
      main{padding:10px;}
      .time{font-size: clamp(3.6rem, 18vw, 8.5rem);}
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="topbar">
        <strong class="brand">BAGDigital<span style="color:var(--b);">.tech</span></strong>
        <div class="top-actions">
          <md-outlined-button onclick="document.getElementById('panel').scrollIntoView({behavior:'smooth'})">
            Organizer / Log
          </md-outlined-button>
          <md-filled-button onclick="document.getElementById('timer').scrollIntoView({behavior:'smooth'})">
            Timer
          </md-filled-button>
        </div>
      </div>
    </header>

    <main>
      <!-- FULL-SCREEN TIMER AREA -->
      <section id="timer" class="timer-screen" tabindex="0" aria-label="Tap anywhere timer screen">
        <div class="timer-top">
          <div class="controls">
            <select id="eventSelect" aria-label="Select event">
              <option value="222">2x2x2</option>
              <option value="333" selected>3x3x3</option>
              <option value="444">4x4x4</option>
              <option value="555">5x5x5</option>
              <option value="666">6x6x6</option>
              <option value="777">7x7x7</option>
              <option value="sq1">Square-1</option>
              <option value="pyram">Pyraminx</option>
              <option value="minx">Megaminx</option>
              <option value="skewb">Skewb</option>
              <option value="clock">Clock</option>
            </select>

            <md-outlined-button id="newScrambleBtn">Next Scramble</md-outlined-button>
            <md-outlined-button id="clearSessionBtn">Clear Session</md-outlined-button>
          </div>

          <div class="scramble" id="scrambleText">Connecting...</div>
        </div>

        <div class="timer-mid">
          <div class="time" id="timeDisplay">0.00</div>

          <div class="meta">
            <span class="pill">Event: <strong id="eventLabel">3x3x3</strong></span>
            <span class="pill">Last: <strong id="lastTime">—</strong></span>
            <span class="pill">Best: <strong id="bestTime">—</strong></span>
          </div>

          <div class="tap-hint">
            Tap anywhere on this screen to <strong>Start / Stop</strong>.
            (Space also works on desktop.)
          </div>
        </div>

        <div class="timer-bottom">
          <md-filled-button id="startStopBtn">Start</md-filled-button>
          <md-outlined-button id="toggleVizBtn">Show / Hide Visualizer</md-outlined-button>
        </div>

        <!-- Optional visualizer overlay (does not resize layout) -->
        <div id="vizWrap" style="display:none; margin-top:10px;">
          <div style="background:#fff;border:1px solid #CCC;border-radius:15px;padding:10px;height:220px;display:flex;align-items:center;justify-content:center;">
            <twisty-player id="player" background="none" control-panel="none" visualization="2D" style="width:100%;height:200px;"></twisty-player>
          </div>
        </div>
      </section>

      <!-- COLLAPSIBLE PANEL FOR ORGANIZER + LOG + CONTACT -->
      <details id="panel" class="panel">
        <summary>Organizer + Session Log + Contact</summary>
        <div class="panel-inner">

          <div class="organizer" aria-label="Competition day organizer">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px; flex-wrap:wrap;">
              <div>
                <div style="font-weight:900; font-size:1.2rem;">Competition Day Organizer</div>
                <div style="color:var(--muted); font-weight:800;">Checklist + notes save on your phone. No resizing.</div>
              </div>
              <md-filled-button id="resetOrganizerBtn">Reset Organizer</md-filled-button>
            </div>

            <div class="org-grid">
              <div class="org-card">
                <h3>5-Minute Ready Check</h3>
                <ul class="checklist">
                  <li><label><input type="checkbox" data-k="badge"> Badge / wristband / check-in done</label></li>
                  <li><label><input type="checkbox" data-k="cube"> Correct cube(s) for next event</label></li>
                  <li><label><input type="checkbox" data-k="tools"> Lube / screwdriver / cloth</label></li>
                  <li><label><input type="checkbox" data-k="water"> Water + snack</label></li>
                  <li><label><input type="checkbox" data-k="warmup"> Warm-up: 3–5 solves, then stop</label></li>
                </ul>
              </div>

              <div class="org-card">
                <h3>Parent Ops Checklist</h3>
                <ul class="checklist">
                  <li><label><input type="checkbox" data-k="schedule"> Next event + group time known</label></li>
                  <li><label><input type="checkbox" data-k="quiet"> Quiet zone plan (lower stress)</label></li>
                  <li><label><input type="checkbox" data-k="food"> Food/hydration between rounds</label></li>
                  <li><label><input type="checkbox" data-k="ride"> End-time + ride plan confirmed</label></li>
                  <li><label><input type="checkbox" data-k="pics"> Photos after solves, not before</label></li>
                </ul>
              </div>

              <div class="org-card">
                <h3>My Notes (rounds / goals / reminders)</h3>
                <textarea class="note" id="notes" placeholder="Example: 3x3 R1 — steady solves. Slow inspection. Breathe."></textarea>
                <div class="mini-actions">
                  <md-outlined-button id="copyNotesBtn">Copy Notes</md-outlined-button>
                  <md-outlined-button id="clearNotesBtn">Clear Notes</md-outlined-button>
                </div>
              </div>

              <div class="org-card">
                <h3>Between-Rounds Plan</h3>
                <ul class="checklist">
                  <li><strong>Right after:</strong> hydrate + reset mentally</li>
                  <li><strong>10–20 min:</strong> light snack, calm hands</li>
                  <li><strong>Last 10 min:</strong> no new algs, no panic</li>
                  <li><strong>Call time:</strong> cube legal, timer ok</li>
                </ul>
              </div>
            </div>
          </div>

          <div style="height:14px;"></div>

          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
            <div style="font-weight:900; font-size:1.2rem;">Session Log (tap timer to add solves)</div>
            <div style="display:flex; gap:10px; flex-wrap:wrap;">
              <md-outlined-button id="copyCsvBtn">Copy CSV</md-outlined-button>
              <md-outlined-button id="downloadCsvBtn">Download CSV</md-outlined-button>
            </div>
          </div>

          <div id="emptyState" style="margin-top:10px; color:var(--muted); font-weight:900;">No solves yet.</div>
          <div id="solveCards" class="solve-cards" aria-label="Session cards"></div>

          <div style="height:18px;"></div>

          <div class="contact" id="contact">
            <h2>Work With BAG Digital</h2>

            <form id="leadForm">
              <input type="text" name="website" tabindex="-1" autocomplete="off"
                     style="position:absolute; left:-9999px; height:1px; width:1px; opacity:0;" />

              <input type="text" name="name" placeholder="Name / Business" required>
              <input type="email" name="email" placeholder="Email Address" required>

              <select name="service" class="form-input" aria-label="Select service">
                <option value="Lead Intake">Lead Intake Automation (from $750)</option>
                <option value="Website">Basic Website + Contact (from $600)</option>
                <option value="Automation">Ops Automation (from $1,500)</option>
              </select>

              <textarea class="form-text" name="message" rows="4" placeholder="What do you want to automate or fix? (lead capture, follow-up, tracking, scheduling, inventory, etc.)"></textarea>

              <button type="submit" class="btn" id="subBtn">Send</button>
            </form>

            <div id="status" class="status"></div>
            <div class="fineprint">I reply with a simple plan. No retainer required.</div>
          </div>

        </div>
      </details>
    </main>
  </div>

  <!-- Scrambler -->
  <script type="module">
    import { randomScrambleForEvent } from "https://cdn.cubing.net/v0/js/cubing/scramble";

    const scrambleText = document.getElementById('scrambleText');
    const eventSelect = document.getElementById('eventSelect');
    const eventLabel = document.getElementById('eventLabel');
    const vizWrap = document.getElementById('vizWrap');
    const player = document.getElementById('player');

    const puzzleMap = {
      "333": "3x3x3", "222": "2x2x2", "444": "4x4x4", "555": "5x5x5", "666": "6x6x6", "777": "7x7x7",
      "sq1": "square1", "pyram": "pyraminx", "minx": "megaminx", "skewb": "skewb", "clock": "clock"
    };

    const eventNames = {
      "222": "2x2x2", "333": "3x3x3", "444": "4x4x4", "555": "5x5x5", "666": "6x6x6", "777": "7x7x7",
      "sq1": "Square-1", "pyram": "Pyraminx", "minx": "Megaminx", "skewb": "Skewb", "clock": "Clock"
    };

    function setEventLabel(){
      eventLabel.textContent = eventNames[eventSelect.value] || eventSelect.value;
    }

    async function updateScramble(){
      const ev = eventSelect.value;
      setEventLabel();
      scrambleText.innerText = "Syncing...";
      try{
        const alg = await randomScrambleForEvent(ev);
        const str = alg.toString();
        scrambleText.innerText = str;

        if (player) {
          player.puzzle = puzzleMap[ev];
          player.alg = str;
        }
      }catch(e){
        scrambleText.innerText = "Error. Please refresh.";
      }
    }

    document.getElementById('newScrambleBtn').onclick = updateScramble;
    eventSelect.onchange = updateScramble;

    document.getElementById('toggleVizBtn').onclick = () => {
      vizWrap.style.display = (vizWrap.style.display === "none") ? "block" : "none";
    };

    updateScramble();
  </script>

  <!-- Timer: tap anywhere on timer screen toggles start/stop -->
  <script>
    const timerScreen = document.getElementById('timer');
    const timeDisplay = document.getElementById('timeDisplay');
    const startStopBtn = document.getElementById('startStopBtn');
    const clearSessionBtn = document.getElementById('clearSessionBtn');

    const lastTimeEl = document.getElementById('lastTime');
    const bestTimeEl = document.getElementById('bestTime');

    const solveCards = document.getElementById('solveCards');
    const emptyState = document.getElementById('emptyState');
    const copyCsvBtn = document.getElementById('copyCsvBtn');
    const downloadCsvBtn = document.getElementById('downloadCsvBtn');

    const eventSelect = document.getElementById('eventSelect');

    const eventNames = {
      "222": "2x2x2", "333": "3x3x3", "444": "4x4x4", "555": "5x5x5", "666": "6x6x6", "777": "7x7x7",
      "sq1": "Square-1", "pyram": "Pyraminx", "minx": "Megaminx", "skewb": "Skewb", "clock": "Clock"
    };

    let running = false;
    let startTime = 0;
    let interval = null;

    window.__bagLastSolve = null;
    let session = [];

    function fmtTime(sec){ return Number(sec).toFixed(2); }

    function updateMeta(){
      if(session.length === 0){
        lastTimeEl.textContent = "—";
        bestTimeEl.textContent = "—";
        return;
      }
      const last = session[session.length - 1];
      lastTimeEl.textContent = `${fmtTime(last.timeSec)}s`;
      const best = session.reduce((m,x)=>Math.min(m,x.timeSec), Infinity);
      bestTimeEl.textContent = `${fmtTime(best)}s`;
    }

    function renderCards(){
      const has = session.length > 0;
      emptyState.style.display = has ? "none" : "block";

      solveCards.innerHTML = has ? session.slice().reverse().map((row) => {
        const when = new Date(row.tsIso).toLocaleString();
        return `
          <div class="solve-card">
            <div>
              <div class="label">Solve</div>
              <div class="value">#${row.n}</div>
            </div>
            <div>
              <div class="label">Event</div>
              <div class="value">${row.eventName}</div>
            </div>
            <div>
              <div class="label">Time</div>
              <div class="value mono">${fmtTime(row.timeSec)}s</div>
            </div>
            <div>
              <div class="label">When</div>
              <div class="value">${when}</div>
            </div>
          </div>
        `;
      }).join("") : "";
    }

    function getCsv(){
      const header = ["solve","event","time_seconds","timestamp_iso"];
      const lines = session.map(r => [r.n, r.eventName, fmtTime(r.timeSec), r.tsIso].join(","));
      return [header.join(","), ...lines].join("\n");
    }

    async function copyCsv(){
      if(session.length === 0) return;
      try{
        await navigator.clipboard.writeText(getCsv());
        copyCsvBtn.textContent = "Copied";
        setTimeout(()=>copyCsvBtn.textContent="Copy CSV", 900);
      }catch{
        copyCsvBtn.textContent = "Copy failed";
        setTimeout(()=>copyCsvBtn.textContent="Copy CSV", 900);
      }
    }

    function downloadCsv(){
      if(session.length === 0) return;
      const blob = new Blob([getCsv()], {type:"text/csv;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "bagdigital_cubing_session.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function startTimer(){
      if(running) return;
      running = true;
      startStopBtn.textContent = "Stop";
      startTime = performance.now();
      interval = setInterval(() => {
        timeDisplay.textContent = ((performance.now() - startTime) / 1000).toFixed(2);
      }, 10);
    }

    function stopTimerAndLog(){
      if(!running) return;
      running = false;
      clearInterval(interval);
      interval = null;

      const elapsed = (performance.now() - startTime) / 1000;
      const elapsedFixed = Number(elapsed.toFixed(2));

      timeDisplay.textContent = elapsedFixed.toFixed(2);
      startStopBtn.textContent = "Start";

      const eventCode = eventSelect.value;
      const eventName = eventNames[eventCode] || eventCode;

      const entry = {
        n: session.length + 1,
        eventCode,
        eventName,
        timeSec: elapsedFixed,
        tsIso: new Date().toISOString()
      };

      session.push(entry);
      window.__bagLastSolve = entry;

      updateMeta();
      renderCards();
    }

    function toggleTimer(){
      if(running) stopTimerAndLog();
      else startTimer();
    }

    function clearSession(){
      running = false;
      if(interval) clearInterval(interval);
      interval = null;

      session = [];
      window.__bagLastSolve = null;

      timeDisplay.textContent = "0.00";
      startStopBtn.textContent = "Start";
      updateMeta();
      renderCards();
    }

    // Tap anywhere on timerScreen toggles start/stop,
    // BUT do not trigger when interacting with controls.
    timerScreen.addEventListener("pointerdown", (e) => {
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toUpperCase() : "";
      const interactive = e.target.closest("button, md-filled-button, md-outlined-button, select, option, a, input, textarea, summary");
      if (interactive) return;
      e.preventDefault();
      toggleTimer();
    });

    // Buttons still work
    startStopBtn.addEventListener("click", (e) => { e.preventDefault(); startStopBtn.blur(); toggleTimer(); });
    clearSessionBtn.addEventListener("click", (e) => { e.preventDefault(); clearSessionBtn.blur(); clearSession(); });

    // Desktop spacebar
    window.addEventListener("keydown", (e) => {
      if(e.code !== "Space") return;
      if(["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)) return;
      e.preventDefault();
      toggleTimer();
    });

    copyCsvBtn.addEventListener("click", copyCsv);
    downloadCsvBtn.addEventListener("click", downloadCsv);

    updateMeta();
    renderCards();
  </script>

  <!-- Organizer persistence (localStorage) -->
  <script>
    const LS_KEY = "bag_competition_organizer_fullscreen_v1";

    const organizerRoot = document.getElementById("panel");
    const notesEl = document.getElementById("notes");
    const copyNotesBtn = document.getElementById("copyNotesBtn");
    const clearNotesBtn = document.getElementById("clearNotesBtn");
    const resetOrganizerBtn = document.getElementById("resetOrganizerBtn");

    function loadOrganizer(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const data = JSON.parse(raw);

        const boxes = organizerRoot.querySelectorAll('input[type="checkbox"][data-k]');
        boxes.forEach((b) => {
          const k = b.getAttribute("data-k");
          if (k in (data.checks || {})) b.checked = !!data.checks[k];
        });

        if(typeof data.notes === "string") notesEl.value = data.notes;
      }catch{}
    }

    function saveOrganizer(){
      try{
        const boxes = organizerRoot.querySelectorAll('input[type="checkbox"][data-k]');
        const checks = {};
        boxes.forEach((b) => checks[b.getAttribute("data-k")] = b.checked);
        localStorage.setItem(LS_KEY, JSON.stringify({ checks, notes: notesEl.value || "" }));
      }catch{}
    }

    function resetOrganizer(){
      const boxes = organizerRoot.querySelectorAll('input[type="checkbox"][data-k]');
      boxes.forEach((b) => b.checked = false);
      notesEl.value = "";
      saveOrganizer();
    }

    organizerRoot.addEventListener("change", (e) => {
      if(e.target && e.target.matches('input[type="checkbox"][data-k]')) saveOrganizer();
    });
    notesEl.addEventListener("input", saveOrganizer);

    copyNotesBtn.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(notesEl.value || "");
        copyNotesBtn.textContent = "Copied";
        setTimeout(()=>copyNotesBtn.textContent="Copy Notes", 900);
      }catch{
        copyNotesBtn.textContent = "Copy failed";
        setTimeout(()=>copyNotesBtn.textContent="Copy Notes", 900);
      }
    });

    clearNotesBtn.addEventListener("click", () => { notesEl.value = ""; saveOrganizer(); });
    resetOrganizerBtn.addEventListener("click", resetOrganizer);

    loadOrganizer();
  </script>

  <!-- Lead form submit -> Google Apps Script Web App (server unchanged) -->
  <script>
    const LEAD_ENDPOINT = "https://script.google.com/macros/s/AKfycbyXBZI3EMxmo3jS0VKhwiky9fVrgiOGGrm3EpYM-WS7v2ZEGkZ8tTODIKno8HhJ00jsew/exec"; // <-- paste your deployed URL
    const HONEYPOT_NAME = "website";

    const form = document.getElementById("leadForm");
    const statusEl = document.getElementById("status");
    const subBtn = document.getElementById("subBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      subBtn.disabled = true;
      subBtn.textContent = "Sending...";

      const fd = new FormData(form);

      if ((fd.get(HONEYPOT_NAME) || "").toString().trim().length > 0) {
        subBtn.disabled = false;
        subBtn.textContent = "Send";
        return;
      }

      fd.append("source", "competition-day-fullscreen-timer");
      fd.append("pageTitle", document.title);
      fd.append("timestamp", new Date().toISOString());
      fd.append("userAgent", navigator.userAgent);

      if (window.__bagLastSolve) {
        fd.append("lastSolveEvent", window.__bagLastSolve.eventName);
        fd.append("lastSolveTimeSec", String(window.__bagLastSolve.timeSec));
      }

      try{
        const organizerRaw = localStorage.getItem("bag_competition_organizer_fullscreen_v1");
        if (organizerRaw) fd.append("organizerData", organizerRaw);
      }catch{}

      try {
        const res = await fetch(LEAD_ENDPOINT, { method: "POST", body: fd });
        const data = await res.json().catch(() => ({}));
        if (!res.ok || !data.ok) throw new Error("Bad response");

        statusEl.textContent = "Received. I’ll reply soon.";
        form.reset();
      } catch (err) {
        statusEl.textContent = "Error sending. Please email Jaime@BAGdigital.tech.";
      } finally {
        subBtn.disabled = false;
        subBtn.textContent = "Send";
      }
    });
  </script>

</body>
</html>
